## ✱ 공부한 내용

- Goals - CompositeAssets - CompositeAssetConnections 테이블 생성 및 연결 관계 정의, CRUD를 생성하면서 Database를 치밀하게 설계한 만큼 프론트 단계에서 CRUD를 생성하는 난이도가 급격하게 내려가는 것을 경험하였다.
- Token을 단지 user의 id만을 담고 로그인 권한만을 실어 나르는 것만으로 사용하였다. 이번에 추가된 기관 사용자를 추가하면서, 기관 인증 및 기관의 타입에 따라 테이블을 나눠서 생성하였다. 이 과정에서 기관의 인증코드 및 기업이나 학교 등의 테이블을 따로 생성하여 관리하게 되었다. 기관과 연결된 회원의 권한을 토큰에 담기 위해 id와 더불어 agency_key또한 담아서 기관 회원의 정보는 기관 회원 정보를 Join하여 주는 방식으로 설정하게 되었다.
  - 테이블을 구성하면서 테이블 간 관계를 잘못 설정하게 되었다. Agency라는 기관의 인증 코드를 담고 있는 테이블, 그리고 Enterprise, School이라는 기관 테이블의 하위 테이블을 구성하여 하위 테이블에 user_id, agency_key를 두어 두개의 FK를 가지고 기관 회원 정보에 접근 할 수 있어야 한다고 생각했다.
  - 하지만, Agency → User의 관계는 1:N, Agency → 하위 테이블은 1:N, 그리고 User → 하위 테이블은 N:1로 설정되었다. 그렇기 때문에 User에서 하위 테이블로 접근하기 위해서는 User → Agency → 하위 테이블의 조인 관계를 거쳐야 한다. 여기서 User의 정보는 1개의 Agency Row를 가져오지만, 1개의 Agency의 Key를 가진 모든 하위 테이블의 회원 정보를 가지고 오게 되어 특정 유저의 정보만 가져오지 못하는 상황이 되었다.
  - 그렇다면 처음 생각한 것처럼 user_id와 agency_key만으로 접근 할 수 있던 것도 아니다. 여기에 agency_type이 하나 더 필요했다. 왜냐하면, Agency의 하위 테이블 중 어떤 하위 테이블에서 정보를 가져와야 하는지 특정해야 하기 때문이다.
  - 그렇다면 근본적인 테이블 정의부터 잘못되었다고 생각되어 내일 다시 테이블을 작성해 볼 예정이다.
