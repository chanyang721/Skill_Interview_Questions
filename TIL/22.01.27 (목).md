> 카테고리 테이블 생성 과정 고민 블로깅

보통 카테고리 테이블을 만드는 이유는 어떤 상품이나 혹은 일정과 같은 데이터에 나만의 인식표를 달기 위해 사용된다. 특히 이번에 만들게 된 카테고리 테이블은 가계부와 같이 소득, 지출에 대한 사용자만의 카테고리를 달기 위해 만드는 테이블이었다. 특징이 있다면 디폴트로 적용되는 카테고리는 모든 유저가 공통적으로 사용하게 되고 사용자가 원하면 추가 삭제를 할 수 있도록 해야한다.

처음에는 디폴트 카테고리 테이블, 그리고 사용자가 추가한 테이블을 따로 만들어서 관리하려고 했다. 그 이유로는 우선 현재 DB구조는 카테고리의 key를 소득 지출에 대한 테이블에서 사용하지 않고 단순하게 카테고리 리스트를 가져와서 해당 리스트의 category_name을 하나의 컬럼으로 저장한다. 카테고리 테이블과 소득 지출 테이블의 연결 관계가 없는 것이다.

처음에는 그럴 수 있지라고 생각했다. 하지만 만약 사용자가 자신의 카테고리 이름을 수정하는 요청을 보낸다면, 서버는 해당 유저의 소득 지출에서 변경된 카테고리를 사용하는 것을 찾아 하나씩 update하는 쿼리를 보내야 하는 비효율이 존재했다.

위와 같이 연결되지 않은 상태에서 사용하는 것은 쓸데없는 쿼리문으로 DB에 접근해야 하는 과정이 늘어나게 되는 것이 마음에 들지 않는다. 따라서, 기존에 category_name을 넣는 방식보다 FK로 등록하여 테이블을 연결하고 enger: true를 이용해서 가져오는 방식으로 구현하려고 한다.

이렇게 했을때 문제가 하나 더 발생한다. 사용자에게 디폴트로 보여줄 카테고리들은 유저 테이블과 N:N 관계를 가지게 된다. 하지만 사용자가 생성한 카테고리는 1:N의 관계를 가진다.

- 이 두 데이터를 하나의 테이블에 넣기 위해서 생각한 방법은 두 가지이다.
  1. 각각의 유저의 id를 가진 똑같은 디폴트 카테고리를 계속 만들어서 관리한다.
     1. 단점: 카테고리 테이블에 똑같은 디폴트 카테고리 테이터가 너무 많이 생긴다.
     2. 장점: 쓰기 편하다, 사용자 카테고리를 다루기 쉽다.
  2. 디폴트 카테고리 테이블, 커스컴 카테고리 테이블, 유저 테이블을 따로 두어 디폴트 카테고리 테이블과 유저 테이블에 Join 테이블을 두어 관리한다.
     1. Join 테이블을 따로 관리해야하기 때문에 단순하게 디폴트 카테고리를 유저별로 반복해서 만드는 것 이상으로 레코드를 생성한다.
     2. Join테이블로 카테고리를 관리해야하기 때문에 연결고리가 더 복잡해진다.
  3. 디폴트 카테고리와 커스텀 카테고리를 하나의 테이블에서 관리하지만, parentKey를 두어 tree형식으로 세부 카테고리를 관리, 디폴트와 커스텀은 user_id의 존재 유무로 구분하는 방법
     1. 1번과 비슷하지만 커스텀 카테고리도 같은 테이블에서 관리하며, tree구조를 같기 때문에 CRUD 과정이 쉽다

어짜피 깊이가 1인 구조이기 때문에 tree구조까지는 필요하지 않고 SQL문으로 가져오는 것도 가능하지만, 카테고리의 특성 상 유저가 그렇게 많은 레코드를 차지하지 않을 것 같다. 때문에, 1번 방법으로 해당 유저의 아이디로 디폴트 카테고리를 반복해서 만들고 해당 키를 parent_key로 설정하는 방법이 카테고리 데이터를 CRUD 하는 과정에서 매우 편할 것 같다. 물론 반복적으로 같은 데이터 레코드를 찍어내는 것이 마음에 걸리지만 현재로서는 이 방법이 최선이라 생각한다.
